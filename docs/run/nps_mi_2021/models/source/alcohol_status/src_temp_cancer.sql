

  create or replace view `nps-omop-project`.`C_SREDH_NPS_MI_STAGING_SIMPLIFIED_2021_VIEWS_ONLY`.`src_temp_cancer`
  OPTIONS()
  as 

with cancer as (
select PATIENT_NUMBER , UPPER(DIAGNOSIS_REASON) as DIAGNOSIS_REASON , DIAGNOSIS_DATE , ROW_NUMBER () OVER
(PARTITION BY PATIENT_NUMBER ORDER BY DIAGNOSIS_DATE) AS R1
from C_SREDH_NPS_MI_STAGING_SIMPLIFIED_2021.DIAGNOSIS
WHERE DIAGNOSIS_REASON LIKE '%NEOPLASM%' OR DIAGNOSIS_REASON LIKE '%FIBROADENO%' 
OR DIAGNOSIS_REASON LIKE '%MENINGIO%' 
OR DIAGNOSIS_REASON LIKE '%TERATO%' 
OR DIAGNOSIS_REASON LIKE '%NEUROFIBRO%' 
OR DIAGNOSIS_REASON LIKE '%LEUKAEM%'
OR DIAGNOSIS_REASON LIKE '%CARCINOMAT%' 
OR DIAGNOSIS_REASON LIKE '%MALIGNA%' OR 
DIAGNOSIS_REASON LIKE '%CHEMOT%' OR DIAGNOSIS_REASON LIKE '%METASTA%' OR 
DIAGNOSIS_REASON LIKE '%LYMPHOMA%' OR DIAGNOSIS_REASON LIKE '%CARCINOMA%' 
OR DIAGNOSIS_REASON LIKE '%SARCOMA%' OR DIAGNOSIS_REASON LIKE '%MELANOMA%'
OR DIAGNOSIS_REASON LIKE '%MYELOMA%' OR DIAGNOSIS_REASON LIKE '%ANCER%'
),

cancer2 as (
select PATIENT_NUMBER, DIAGNOSIS_REASON, DIAGNOSIS_DATE , R1 from 
cancer where 
R1 = (SELECT MIN(R1) FROM cancer)
)

select * from cancer2;

