

  create or replace table `nps-omop-project`.`C_SREDH_NPS_MI_STAGING_SIMPLIFIED_2021`.`PATHOLOGY_ALBUMIN`
  
  
  OPTIONS()
  as (
    


with pathology_albumin as (

select
cast(lbpa.HUB_SITE_PATIENT_SK as STRING) as PATIENT_NUMBER,
cast(hbpo.SITE_ID as STRING) as SITE_ID,
cast(hbpo.PATHOLOGY_ID AS STRING) as PATHOLOGY_ID,
cast(sbpa.PATHOLOGY_TEST_DATETIME as STRING) as PATHOLOGY_TEST_DATETIME,
cast(sbpa.PATHOLOGY_TEST_TYPE as STRING) as PATHOLOGY_TEST_TYPE,
cast(sbpa.LOINC_CODE as STRING) AS LOINC_CODE,
cast(sbpa.LOINC_CODE_VALID_INDICATOR as STRING) as LOINC_CODE_VALID_INDICATOR,
cast(sbpa.RESULT_VALUE_CIS as STRING) AS RESULT_VALUE_CIS,
cast(sbpa.RESULT_VALUE_STND as STRING) AS RESULT_VALUE_STND,
cast(sbpa.RESULT_VALUE_TYPE as STRING) AS RESULT_VALUE_TYPE,
cast(sbpa.DETECTED_CIS_UNIT_OF_MEASURE as STRING) as DETECTED_CIS_UNIT_OF_MEASURE,
cast(sbpa.RESULT_UNIT_OF_MEASURE_STND as STRING) as RESULT_UNIT_OF_MEASURE_STND,
cast(sbpa.RESULT_AVAILABLE_INDICATOR as STRING) AS RESULT_AVAILABLE_INDICATOR,
cast(sbpa.RESULT_VALID_RANGE_INDICATOR as STRING) as RESULT_VALID_RANGE_INDICATOR,
cast(sbpa.RESULT_VALID_FORMAT_INDICATOR as STRING) AS RESULT_VALID_FORMAT_INDICATOR,
cast(sbpa.RESULT_INVALID_REASON as STRING) AS RESULT_INVALID_REASON,
cast(sbpa.RESULT_IMPORT_INDICATOR as STRING) as RESULT_IMPORT_INDICATOR,
cast(sbpa.RESULT_HEADER_ONLY_INDICATOR as STRING) as RESULT_HEADER_ONLY_INDICATOR,
cast(sbpa.RESULT_TRANSMISSION_TYPE as STRING) AS RESULT_TRANSMISSION_TYPE,
cast('<34 mg/mmol' as STRING) AS ALBUMIN_ACR_RESULT_VALUE_RANGE,
cast('<30 mg/g' as STRING) AS ALBUMIN_CONCENTRATION_RESULT_VALUE_RANGE
from 
`nps-omop-project`.`B_SREDH_NPS_MI_SF_RDV_BDV_2021`.`HUB_BDV_PATHOLOGY_OMOP` hbpo
inner join 
`nps-omop-project`.`B_SREDH_NPS_MI_SF_RDV_BDV_2021`.`SAT_BDV_PATHOLOGY_ALBUMIN_OMOP` sbpa
on hbpo.HUB_BDV_PATHOLOGY_SK = sbpa.HUB_BDV_PATHOLOGY_SK
inner join 
`nps-omop-project`.`B_SREDH_NPS_MI_SF_RDV_BDV_2021`.`LNK_BDV_PATHOLOGY_OMOP` lbpa
on hbpo.HUB_BDV_PATHOLOGY_SK = lbpa.HUB_BDV_PATHOLOGY_SK
inner join 
`nps-omop-project`.`B_SREDH_NPS_MI_SF_RDV_BDV_2021`.`LSAT_BDV_PATHOLOGY_OMOP` lsbpa
on lbpa.LNK_BDV_PATHOLOGY_SK = lsbpa.LNK_BDV_PATHOLOGY_SK
WHERE 
	sbpa.OMD_CURRENT_RECORD_INDICATOR = 'Y'
	AND sbpa.OMD_DELETED_RECORD_INDICATOR = 'N'
    AND lsbpa.OMD_CURRENT_RECORD_INDICATOR = 'Y'
	AND lsbpa.OMD_DELETED_RECORD_INDICATOR = 'N'
)

select * from pathology_albumin
  );
  